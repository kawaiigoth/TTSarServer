# Server.js
Веб-приложение, на данный момент, представляющее собой api, для работы с маршрутами троллейбусов и автобусов города Саратова.


###Что качать

Обычным образом скачать/клонировать файлы с репозитория.

### Как ставить

Для установки приложения, выполните в консоли команду `npm install`, находясь в папке со скачанными файлами. 

######Примечание:

 * 'libpq-dev' -  ставится так в Ubuntu http://askubuntu.com/questions/672408/can-not-install-libpq-dev-in-ubuntu-14-04
 * 'node-gyp rebuild' (вызывается во время 'npm install') требует python (работает со второй веткой по умолчанию)
 
 
Для развертывания базы данных:
    
1. Запустите консоль.
2. Наберите команду `psql -U username -c "CREATE DATABASE /"TTSar/""` где username это имя пользователя, поумолчанию - postgres
4. Перейдите в каталог `Assets`  скачанного приложения используя команду `cd` ну или еще какую другую =)
3. Наберите команду `psql -U username TTSar < TTSarDB.sql`

    
###Как настроить

В папке `config` вы найдете фаил `config.json`

 Настраиваемые параметры:
 
  1. port - *порт на котором стартует приложение*
  2. db:user - *имя пользователя базы данных*
  3. db:database - *имя базы данных*
  4. db:host - *хост* ( хз, как обозвать)
  5. db:port - *номер порта на котром запскается база данных*
  6. db:password - *пароль к базе данных*
  
  Пример:

    {
      "port": 8080,
      "db": {
        "user": "postgres",
        "database": "TTSar",
        "host":"localhost",
        "port": 5432,
        "password":"123456789"
      }
    }


###Как запустить
 
Набрать в консоли `node server.js`
Индикатором успешного запуска, будет сообщение в консоли:
 
`info: [Path\server.js] Running at Port 8080`  - где на месте 8080, может быть другой порт.

Для запуска теста наберите `npm test`

Ответы пока выводятся в консоль, однако есть простая визуализация показывающая какакие тесты прошли, а какие нет. Визуализированное представление находится в `mochawesome-reports/mochawesome.html`

### REST API

  [SERVER.html](https://trello-attachments.s3.amazonaws.com/57f3c5c0c09f308ffeecb6aa/57f823bdcb36529411fdd73c/6b710bc9061013e86cd7d9dc31c2b02f/server.html "Ccылка на Trello, пока еще не подправленно содержание, но тестить можно.")


### Коды ошибок приложения:
 
 В случае не правильной работы сервера, или не правильных запросов, приложение будет возвращать ошибки( что логично=):
 
 ######Пустные ошибки:
 * 404 - такой страницы нет/не найдена
 * 500 - значит, что-то случилось с самим сервером( в любом случае смотрите логи в консоли)
 
 ######Ошибки возвращающие код в json формате:
 * 01 - пустое тело запроса
 * 02 - не правильное тело запроса
 * 11 - ошибка SELECT - ни одна строка не был найдена ( скорее всего параметры переданные в запрос не позволяют найти хоть что-то.)
 * 10 - ошибка SELECT - смотрите описание ошибки в логах в консоли
 * 31 - ошибка UPDATE - ни одна строка не была изменена ( скорее всего параметры переданный в запрос не соотвествуют ни одной строке)
 * 30 - ошибка UPDATE - смотрите описание ошибки в логах в консоли
 * 20 - ошибка INSERT - смотрите описание ошибки в логах в консоли.

`